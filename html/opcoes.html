<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Horta - Escolher Plantas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .transition-garden {
            transition: all 0.3s ease;
        }

        .shadow-garden {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .text-garden-secondary {
            color: #2f4f4f;
        }

        .bg-garden-success {
            background-color: #10b981;
        }

        .text-garden-success {
            color: #10b981;
        }

        .border-garden-primary-light {
            border-color: rgba(100, 116, 139, 0.2);
        }

        .text-muted-foreground {
            color: #6b7280;
        }

        .bg-garden-primary {
            background-color: #10b981;
        }

        .bg-garden-primary-light {
            background-color: rgba(16, 185, 129, 0.1);
        }

        .plant-card {
            background: white;
            border-radius: 12px;
            border: 2px solid rgba(100, 116, 139, 0.1);
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .plant-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .plant-card.selected {
            border-color: #10b981;
            background-color: rgba(16, 185, 129, 0.05);
        }
    </style>
</head>

<body class="bg-green-50 min-h-screen flex flex-col items-center p-6">
    <div class="max-w-6xl w-full">
        <header class="mb-12 text-center">
            <div class="flex items-center justify-center gap-3">
                <span class="text-3xl">üå±</span>
                <h1 class="text-4xl font-bold text-garden-secondary">Escolha Sua Planta</h1>
            </div>
            <p class="text-muted-foreground mt-2" id="user-welcome">Selecione uma planta para cultivar</p>
        </header>

        <div id="plantas-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Cards ser√£o inseridos dinamicamente -->
        </div>

        <div class="text-center mt-12">
            <button id="confirm-selection"
                class="bg-garden-primary text-white font-semibold py-3 px-8 rounded-lg hover:bg-garden-success/80 transition-garden text-lg disabled:opacity-50 disabled:cursor-not-allowed"
                disabled>
                Confirmar Sele√ß√£o
            </button>
            <a href="index.html" class="ml-4 text-garden-secondary hover:underline">‚Üê Voltar</a>
        </div>

        <footer class="mt-12 text-center text-muted-foreground">
            ¬© 2024 Minha Horta. Todos os direitos reservados.
        </footer>
    </div>

    <script>
        // Base de dados de plantas (apenas verduras e temperos)
        const plantasData = {
            verduras: [
                {
                    id: 'alface',
                    nome: 'Alface',
                    imagem: '/img/alface.jfif',
                    descricao: 'Folha verde f√°cil de cultivar, ideal para saladas frescas.',
                    dificuldade: 'F√°cil',
                    luz: '4-6h sol direto (tolera meia-sombra)',
                    rega: 'Frequente - solo sempre √∫mido, mas sem encharcar',
                    colheita: '30-60 dias (dependendo do tipo)',
                    temperatura: '15-23¬∞C (ideal 18-20¬∞C)',
                    categoria: 'verdura'
                },
                {
                    id: 'rucula',
                    nome: 'R√∫cula',
                    imagem: '../img/rucula.jfif',
                    descricao: 'Folhagem picante e nutritiva, perfeita para saladas.',
                    dificuldade: 'Muito F√°cil',
                    luz: '4-6h sol (prefere meia-sombra em climas quentes)',
                    rega: 'Frequente - a cada 1-2 dias em tempo seco',
                    colheita: '25-40 dias (corte e volta)',
                    temperatura: '15-25¬∞C (ideal 18-22¬∞C)',
                    categoria: 'verdura'
                },
                {
                    id: 'couve',
                    nome: 'Couve',
                    imagem: '../img/couve.jfif',
                    descricao: 'Folhagem verde e robusta, muito vers√°til na cozinha.',
                    dificuldade: 'F√°cil',
                    luz: '6-8h sol direto (tolera meia-sombra)',
                    rega: 'A cada 2-3 dias - gosta de umidade constante',
                    colheita: '55-80 dias (folhas externas, colheita cont√≠nua)',
                    temperatura: '10-30¬∞C (ideal 18-25¬∞C)',
                    categoria: 'verdura'
                },
                {
                    id: 'espinafre',
                    nome: 'Espinafre',
                    imagem: '../img/espinafre.jfif',
                    descricao: 'Rico em nutrientes, perfeito para sucos e refogados.',
                    dificuldade: 'Moderado (sobe f√°cil em calor)',
                    luz: '4-6h sol (prefere meia-sombra no ver√£o)',
                    rega: 'Frequente - solo sempre √∫mido',
                    colheita: '40-60 dias (corte e volta)',
                    temperatura: '15-20¬∞C (ideal abaixo de 24¬∞C)',
                    categoria: 'verdura'
                }
            ],
            temperos: [
                {
                    id: 'manjericao',
                    nome: 'Manjeric√£o',
                    imagem: '../img/majericao.jfif',
                    descricao: 'Erva arom√°tica perfeita para molhos e temperos.',
                    dificuldade: 'F√°cil a Moderado',
                    luz: '6-8h sol direto',
                    rega: 'Di√°rio ou a cada 2 dias - n√£o gosta de solo encharcado',
                    colheita: '60-90 dias (colheita cont√≠nua de folhas)',
                    temperatura: '21-29¬∞C (m√≠nima 15¬∞C)',
                    categoria: 'tempero'
                },
                {
                    id: 'salsa',
                    nome: 'Salsa',
                    imagem: '../img/salsa.jfif',
                    descricao: 'Erva arom√°tica vers√°til para diversos pratos.',
                    dificuldade: 'F√°cil',
                    luz: '4-6h sol (tolera meia-sombra)',
                    rega: 'A cada 2-3 dias - manter solo √∫mido',
                    colheita: '70-90 dias (folhas externas primeiro)',
                    temperatura: '15-25¬∞C',
                    categoria: 'tempero'
                },
                {
                    id: 'cebolinha',
                    nome: 'Cebolinha',
                    imagem: '../img/cebolinha.jfif',
                    descricao: 'Tempero vers√°til para saladas, sopas e omeletes.',
                    dificuldade: 'Muito F√°cil',
                    luz: '4-6h sol (cresce bem em meia-sombra)',
                    rega: 'A cada 2 dias - gosta de umidade',
                    colheita: '60-80 dias (colheita cont√≠nua)',
                    temperatura: '15-25¬∞C',
                    categoria: 'tempero'
                },
                {
                    id: 'alecrim',
                    nome: 'Alecrim',
                    imagem: '../img/alecrim.jfif',
                    descricao: 'Arbusto arom√°tico resistente para carnes e assados.',
                    dificuldade: 'F√°cil (muito resistente)',
                    luz: '6-8h sol pleno',
                    rega: 'Moderada - a cada 5-7 dias quando estabelecido',
                    colheita: 'A partir de 90-120 dias (colheita cont√≠nua)',
                    temperatura: '15-30¬∞C (suporta at√© 35¬∞C)',
                    categoria: 'tempero'
                }
            ]
        };

        let plantaSelecionada = null;
        let dadosUsuario = {};

        function carregarPlantas() {
            // Obt√©m os dados da URL
            const parametrosUrl = new URLSearchParams(window.location.search);
            const parametroDados = parametrosUrl.get('data');

            if (!parametroDados) {
                document.getElementById('plantas-container').innerHTML =
                    '<p class="text-center text-muted-foreground col-span-3">Dados n√£o encontrados. Volte √† p√°gina anterior.</p>';
                return;
            }

            try {
                dadosUsuario = JSON.parse(decodeURIComponent(parametroDados));

                // Atualiza sauda√ß√£o
                document.getElementById('user-welcome').textContent =
                    `Ol√° ${dadosUsuario.nome}! Selecione uma planta para cultivar`;

                // Filtra plantas baseado nas categorias selecionadas
                const plantasRecomendadas = [];

                if (dadosUsuario.categorias.temperos) {
                    plantasRecomendadas.push(...plantasData.temperos);
                }
                if (dadosUsuario.categorias.verduras) {
                    plantasRecomendadas.push(...plantasData.verduras);
                }

                // Renderiza as plantas
                const container = document.getElementById('plantas-container');
                container.innerHTML = '';

                plantasRecomendadas.forEach(planta => {
                    const card = `
                <div class="plant-card" data-plant-id="${planta.id}">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-xl font-bold text-garden-secondary">${planta.nome}</h3>
                        <span class="bg-garden-success/20 text-garden-success px-2 py-1 rounded-full text-xs font-medium">
                            ${planta.categoria}
                        </span>
                    </div>
                    <img src="${planta.imagem}" 
                            alt="${planta.nome}" 
                            class="w-full h-48 object-cover rounded-lg mb-4" 
                            onerror="this.src='img/placeholder.png'; this.onerror=null;">
                    <p class="text-muted-foreground mb-4 text-sm leading-relaxed">${planta.descricao}</p>
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div class="flex items-center gap-2"><span>‚òÄÔ∏è</span><span class="text-muted-foreground">${planta.luz}</span></div>
                                <div class="flex items-center gap-2"><span>üíß</span><span class="text-muted-foreground">${planta.rega}</span></div>
                                <div class="flex items-center gap-2"><span>‚è±Ô∏è</span><span class="text-muted-foreground">${planta.colheita}</span></div>
                                <div class="flex items-center gap-2"><span>üå°Ô∏è</span><span class="text-muted-foreground">${planta.temperatura}</span></div>
                    </div>
                    <div class="mt-4 text-center">
                        <span class="text-xs text-garden-success font-medium">${planta.dificuldade}</span>
                    </div>
                </div>
            `;
                    container.innerHTML += card;
                });

                // Adiciona evento de clique nos cards
                document.querySelectorAll('.plant-card').forEach(card => {
                    card.addEventListener('click', function () {
                        // Remove sele√ß√£o anterior
                        document.querySelectorAll('.plant-card').forEach(c => {
                            c.classList.remove('selected');
                        });

                        // Adiciona sele√ß√£o atual
                        this.classList.add('selected');
                        plantaSelecionada = this.getAttribute('data-plant-id');

                        // Habilita o bot√£o de confirma√ß√£o
                        document.getElementById('confirm-selection').disabled = false;
                    });
                });

            } catch (erro) {
                console.error('Erro ao carregar dados:', erro);
                document.getElementById('plantas-container').innerHTML =
                    '<p class="text-center text-muted-foreground col-span-3">Erro ao carregar os dados.</p>';
            }
        }

        function confirmarSelecao() {
            if (!plantaSelecionada) {
                alert('Por favor, selecione uma planta.');
                return;
            }

            // Busca a planta completa pelo ID
            const plantaEscolhida = [...plantasData.verduras, ...plantasData.temperos]
                .find(p => p.id === plantaSelecionada);

            if (!plantaEscolhida) {
                alert('Planta n√£o encontrada.');
                return;
            }

            // SALVA NO localStorage 
            const novaPlanta = {
                id: `planta-${Date.now()}`,
                tipo: plantaEscolhida.id,
                nome: plantaEscolhida.nome,
                imagem: plantaEscolhida.imagem,
                dataPlantio: new Date().toISOString(),
                progresso: 0,
                saudavel: true,
                metodo: 'vasos',
                tarefasPendentes: gerarTarefasIniciais(plantaEscolhida.id)
            };

            // Salva no localStorage
            let plantasUsuario = [];
            const plantasSalvas = localStorage.getItem('hortaPlants');
            if (plantasSalvas) {
                plantasUsuario = JSON.parse(plantasSalvas);
            }
            plantasUsuario.push(novaPlanta);
            localStorage.setItem('hortaPlants', JSON.stringify(plantasUsuario));

            // Salva usu√°rio (se ainda n√£o existir)
            if (!localStorage.getItem('hortaUser')) {
                localStorage.setItem('hortaUser', JSON.stringify({ nome: dadosUsuario.nome }));
            }

            window.location.href = `conclusaoTarefas.html?plant=${plantaSelecionada}`;
        }

        function gerarTarefasIniciais(tipo) {
            const tarefas = {
                alface: [
                    'Manter uma rotina leve de regas di√°rias',
                    'Evitar exposi√ß√£o ao sol forte nos primeiros dias',
                    'Garantir que o local mantenha boa ventila√ß√£o'
                ],
                rucula: [
                    'Regar de forma leve a cada dia ou dois',
                    'Manter em local iluminado, por√©m sem calor excessivo',
                    'Evitar mover o vaso nos primeiros dias'
                ],
                couve: [
                    'Manter o solo sempre √∫mido com regas leves',
                    'Deixar em um local com boa luz natural',
                    'Proteger de vento forte'
                ],
                manjericao: [
                    'Fazer pequenas regas diariamente',
                    'Manter em ambiente iluminado e est√°vel',
                    'Evitar deixar a superf√≠cie secar completamente'
                ],
                salsa: [
                    'Regar suavemente todos os dias',
                    'Deixar em local com sombra leve e ilumina√ß√£o constante',
                    'Manter o ambiente est√°vel sem mudan√ßas bruscas'
                ],
                cebolinha: [
                    'Realizar regas leves diariamente',
                    'Manter o vaso em local luminoso',
                    'Evitar que a camada superficial seque totalmente'
                ],
                alecrim: [
                    'Fazer regas leves em dias alternados',
                    'Manter em √°rea bem iluminada',
                    'Evitar excesso de umidade ao redor'
                ],
                espinafre: [
                    'Regar levemente todos os dias',
                    'Deixar em local com luz indireta',
                    'Evitar exposi√ß√£o ao sol forte inicialmente'
                ],
                default: [
                    'Manter regas leves e regulares',
                    'Deixar o vaso em local iluminado e est√°vel',
                    'Evitar exposi√ß√£o forte ao sol nos primeiros dias'
                ]

            };
            return tarefas[tipo] || tarefas.default;
        }

        // Fun√ß√£o de envio para API (simulada)
        function enviarParaDashboard(dados) {
            fetch('/api/selecao-planta', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(dados)
            })
                .then(resposta => resposta.json())
                .then(resultado => {
                    console.log('Sucesso:', resultado);
                })
                .catch(erro => {
                    console.error('Erro ao enviar:', erro);
                });
        }

        // Eventos
        document.getElementById('confirm-selection').addEventListener('click', confirmarSelecao);

        // Carrega as plantas ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', carregarPlantas);
    </script>
</body>

</html>